# Dikarier Core Plugin для RPG Maker MZ

**Версия:** 1.3
**Автор:** Dizia DK (Dikarier Plugin)  
**Лицензия:** MIT

Фундаментальная библиотека-ядро для RPG Maker MZ, служащая базой для системы Dikarier и предоставляющая сборник мощных утилит для расширения возможностей движка.

[Читать на английском (Read in English)](README.md)

---

## Введение

Dikarier Core (DCore) — это **фундаментальная библиотека** для экосистемы плагинов Dikarier. Хотя она содержит мощный сборник независимых утилит, её основная цель — служить фундаментом для работы других сложных механик.

**ВАЖНО:** Данный плагин является **ОБЯЗАТЕЛЬНОЙ ЗАВИСИМОСТЬЮ** для следующих плагинов:
*   `Dikarier_NeedsSystem`
*   `Dikarier_StatisticPlugin`

Вы должны установить **Dikarier Core** ВЫШЕ этих плагинов в менеджере плагинов для их корректной работы.

## Лицензия

Этот плагин распространяется по лицензии **MIT**. Это означает, что вы можете использовать, копировать, изменять, публиковать и распространять его в любых целях, при условии сохранения оригинального уведомления об авторских правах в исходном коде.

## Требования и совместимость

### Порядок плагинов
1.  **Dikarier_Core** (Разместите этот плагин в самом верху списка ваших плагинов Dikarier)
2.  Dikarier_NeedsSystem / Dikarier_StatisticPlugin / и т.д.

### Требования к системе времени
Для работы модулей **Ночная музыка (OST)** и **Таймеры (игровые дни/часы)** вашему проекту необходим **любой** плагин, который управляет внутриигровым временем. Этот плагин должен обновлять значение **Переменной часов** и **Переключателя ночи**, которые вы настраиваете в параметрах DCore.

## Установка

1.  Скачайте файл `Dikarier_Core.js`.
2.  Поместите файл в папку `js/plugins` вашего проекта.
3.  Откройте проект в RPG Maker MZ, зайдите в **Менеджер плагинов**.
4.  Добавьте `Dikarier_Core` в список.
5.  **Убедитесь, что он находится выше зависимых плагинов.**
6.  Настройте параметры плагина по необходимости.

## Возможности и модули

-   **Привязка клавиш:** Назначайте общие события на нажатия клавиш.
-   **Снятие лимитов характеристик:** Убирайте ограничения на параметры оружия и брони.
-   **Требования предметов для навыков:** Блокируйте навыки, если у игрока нет нужных предметов.
-   **Автоматический полноэкранный режим:** Запускайте игру сразу в full-screen.
-   **Ночная музыка (OST):** Динамически меняйте музыку в зависимости от времени суток.
-   **Таймеры:** Мощная система таймеров (секунды, игровые дни и часы).
-   **Звук печати:** Добавляйте атмосферный звук при появлении текста в диалогах.
-   **Меню выхода:** Добавляйте настраиваемую кнопку выхода на главный экран.
-   **Пользовательские ошибки:** Вызывайте окно с ошибкой через команду плагина.
-   **Глобальный апдейт:** Выполняйте JS-скрипты на сцене карты каждый кадр.
-   **API-функции:** Обширная библиотека функций для разработчиков.

## Как использовать

### Снятие лимитов характеристик
В заметках оружия или брони используйте тег `<DikarierUS>`:
```
<DikarierUS>
mhp: 5000
atk: 999
price: 10000
</DikarierUS>
```
**Доступные параметры:** `mhp`, `mmp`, `atk`, `def`, `mat`, `mdf`, `agi`, `luk`, `price`.

### Требования предметов для навыков
В заметках навыка используйте тег `<DikarierSBI>`:
```
<DikarierSBI>
item: 7   // ID предмета
count: 1  // Количество (по умолчанию 1)
</DikarierSBI>
```
Навык будет недоступен, если в инвентаре нет нужного количества предметов, которые будут израсходованы после использования.

### Ночная музыка (OST)
В заметках карты используйте тег `<DikarierNightOST>`:
```
<DikarierNightOST: Town_Night>  // Устанавливает трек Town_Night
<DikarierNightOST: None>        // Отключает музыку ночью
```
Музыка сменится, когда переключатель, указанный в параметрах, будет включен.

### Меню выхода
Включите опцию "Добавить кнопку в меню" в параметрах плагина и настройте тексты и размеры окна. Кнопка появится на титульном экране.

### API-функции (для вызова в скриптах)

#### Предметы и экипировка
-   `DCore.itemCount(id, action, count)`
-   `DCore.weaponCount(id, action, count)`
-   `DCore.armorCount(id, action, count)`

`action` (необязательно) - строка для сравнения: `"=="`, `">="`, `"<="`, `">"`, `"<"`. Если `action` не указан, используется `">="`.  
**Пример:** `DCore.itemCount(10, ">=", 5)` вернет true, если предмета с ID 10 в инвентаре 5 или больше.

#### Утилиты
-   `DCore.thisRegion()` — Возвращает ID региона, на котором стоит игрок.
-   `DCore.membersInParty(ID)` — Проверяет, есть ли актер с указанным ID в группе.
-   `DCore.changeName(ID, length)` — Открывает сцену смены имени для актера.

#### Математика и вероятность
-   `DCore.random(min, max)` — Возвращает случайное целое число.
-   `DCore.randFloat(min, max)` — Возвращает случайное число с плавающей точкой.
-   `DCore.persentRandom(percent)` — Возвращает `true` с указанным шансом в процентах (0-100).

#### Работа с файлами
-   `DCore.getData(fileName)` — Асинхронная загрузка JSON из папки `data/` (возвращает Promise).
-   `DCore.getDataSync(fileName)` — Синхронная загрузка JSON (требует среду Node.js/NW.js).

## Команды плагина

-   **Запустить таймер (локальный переключатель):** Запускает таймер, который включает локальный переключатель по истечении времени.
-   **Запустить таймер в секундах:** Запускает таймер, который вызывает общее событие через указанное количество реальных секунд.
-   **Запустить таймер игровых дней:** Вызывает общее событие через указанное количество игровых дней.
-   **Запустить таймер игровых часов:** Вызывает общее событие через указанное количество игровых часов.
-   **Вызвать ошибку:** Показывает настраиваемое окно с ошибкой и принудительно закрывает игру.
